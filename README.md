# jwl-backup-merger

This Python-based utility simplifies the process of merging backups made by the JW Library app.

## Features

- Combine two or more JW Library backups into one, which can then be re-imported into JW Library on all your devices.
- Automatically detect and merge conflicting data between backups.
- Coming soon: allow for manual conflict resolution.

## Warning and disclaimer
Before attempting to restore merged backups generated by this app, it is **strongly recommended** to create backups using JW Library on **all** your devices and to store these backups safely.

Please note that this project is not affiliated with jw.org or the official JW Library app. It is an independent tool created by me, for personal use. Use this app at your own risk.

## Usage

Pre-requisites:

    pip install tqdm tk python-dateutil requests questionary

Running the app:

    python jwl-backup-merger.py [--debug] [--folder FOLDER_PATH] [--file FILE_PATH] [--file FILE_PATH] ...

### Arguments

- `--folder FOLDER_PATH`: Folder containing JW Library backups to merge.
- `--file FILE_PATH`: JW Library backup to add to the list of backups to merge. You can specify multiple `--file` arguments to merge multiple backups.
- `--debug`: Enable verbose output and keep temporary working files for debugging.
- `--conflict-policy prompt|current|incoming|merged`: Choose interactive or automatic conflict resolution behavior.
- `--verbose-stats`: Print per-table counts for each input DB, merged counts, dedup stats, and dropped-item reasons.

When using `--conflict-policy prompt`, you can optionally configure source preferences at runtime (for highlights, notes, bookmarks, and input fields) by `KeySymbol` and assign a preferred input backup file to auto-resolve conflicts for matching records.

In a TTY terminal with `questionary` installed, initial confirmation prompts, KeySymbol selection, and source-file selection all support interactive keyboard navigation (arrow keys + space/enter). For priority lists, after checkbox selection the app asks for explicit ranking so priority follows your chosen order. In non-interactive environments or when `questionary` is unavailable, it falls back to number-based prompts.

The merger now processes data table-by-table across all sources (instead of one source at a time), while preserving FK/PK constraints from a copied base DB.

When running in prompt mode, you can configure:
- per-table source priority fallback order (Bookmark/InputField/Note/UserMark),
- highlight color priority for identical-range highlight conflicts, and
- KeySymbol-specific source preferences.

These preferences are saved to `~/.jw-backup-merger.json` and reloaded on future runs (you can still change them each run).

### Example usage

    python jwl-backup-merger.py --folder /path/to/folder-with-jwl-backups
    python jwl-backup-merger.py --folder /path/to/folder-with-jwl-backups --file /path/to/additional-file1.jwlibrary
    python jwl-backup-merger.py --file /path/to/phone.jwlibrary --file /path/to/tablet.jwlibrary --file /path/to/computer.jwlibrary
